# ![C Thing Software](https://www.cthing.com/branding/CThingSoftware-57x60.png "C Thing Software") assertj-gradle

[![CI](https://github.com/cthing/assertj-gradle/actions/workflows/ci.yml/badge.svg)](https://github.com/cthing/assertj-gradle/actions/workflows/ci.yml)
[![Maven Central](https://maven-badges.herokuapp.com/maven-central/org.cthing/assertj-gradle/badge.svg)](https://maven-badges.herokuapp.com/maven-central/org.cthing/assertj-gradle)
[![javadoc](https://javadoc.io/badge2/org.cthing/assertj-gradle/javadoc.svg)](https://javadoc.io/doc/org.cthing/assertj-gradle)

This Java library provides custom [AssertJ](https://assertj.github.io/doc/) assertions for Gradle plugin project tests. Assertions
are provided for the following Gradle objects:

- [Configuration](https://docs.gradle.org/current/javadoc/org/gradle/api/artifacts/Configuration.html)
- [Directory](https://docs.gradle.org/current/javadoc/org/gradle/api/file/Directory.html)
- [DirectoryProperty](https://docs.gradle.org/current/javadoc/org/gradle/api/file/DirectoryProperty.html)
- [FileCollection](https://docs.gradle.org/current/javadoc/org/gradle/api/file/FileCollection.html)
- [Project](https://docs.gradle.org/current/javadoc/org/gradle/api/Project.html)
- [RegularFile](https://docs.gradle.org/current/javadoc/org/gradle/api/file/RegularFile.html)
- [RegularFileProperty](https://docs.gradle.org/current/javadoc/org/gradle/api/file/RegularFileProperty.html)
- [Task](https://docs.gradle.org/current/javadoc/org/gradle/api/Task.html)

## Usage
The library is available from [Maven Central](https://repo.maven.apache.org/maven2/org/cthing/assertj-gradle/) using the following Maven dependency:
```xml
<dependency>
  <groupId>org.cthing</groupId>
  <artifactId>assertj-gradle</artifactId>
  <version>3.0.0</version>
</dependency>
```
or the following Gradle dependency:
```kotlin
implementation("org.cthing:assertj-gradle:3.0.0")
```

## Examples

### Asserting a Gradle Project Applies a Plugin
```java
import static org.cthing.assertj.gradle.GradleAssertions.assertThat;
...
assertThat(project).hasPlugin("java");
```
Multiple plugins can be checked in one call.
```java
import static org.cthing.assertj.gradle.GradleAssertions.assertThat;
...
assertThat(project).hasPlugin("java", "checkstyle");
```

### Asserting a Gradle Project Contains a Task With Type
```java
assertThat(project).hasTaskWithType(MyTask.class);
```

### Asserting a Gradle Property Contains a Specific Value
```java
import static org.cthing.assertj.gradle.GradleAssertions.assertThat;
...
final Property<String> myProperty = project.getObjects().property(String.class).convention("abcd");
assertThat(myProperty).contains("abcd");
```

See the [Gradle Plugin Unit Testing](https://www.cthing.com/#/blog/gradlePluginUnitTesting) blog post
for addtional information and examples. 

## Building
The library is compiled for Java 17. If a Java 17 toolchain is not available, one will be downloaded.

Gradle is used to build the library:
```bash
./gradlew build
```
The Javadoc for the library can be generated by running:
```bash
./gradlew javadoc
```

## Releasing
This project is released on the [Maven Central repository](https://central.sonatype.com/artifact/org.cthing/assertj-gradle).
Perform the following steps to create a release.

- Commit all changes for the release
- In the `build.gradle.kts` file, edit the `ProjectVersion` object
    - Set the version for the release. The project follows [semantic versioning](https://semver.org/).
    - Set the build type to `BuildType.release`
- Commit the changes
- Wait until CI builds the release candidate
- Run the command `mkrelease assertj-gradle <version>`
- In a browser go to the [Maven Central Repository](https://central.sonatype.com/)
- Log in
- Select `Publish` from the menubar
- Press `Publish Component`
- Enter a name for the deployment
- Choose the file `assertj-gradle-bundle-<version>.zip`
- Press `Publish Component`
- Refresh the page until the deployment has been validated
- Press `Publish`
- Refresh the page until the status is `Published`
- Log out
- Delete the file `assertj-gradle-bundle-<version>.zip`
- In a browser, go to the project on GitHub
- Generate a release with the tag `<version>`
- In the build.gradle.kts file, edit the `ProjectVersion` object
    - Increment the version patch number
    - Set the build type to `BuildType.snapshot`
- Update the `CHANGELOG.md` with the changes in the release and prepare for next release changes
- Update the `Usage` section in the `README.md` with the latest artifact release version
- Commit these changes
